<?xml version="1.0"?>
<!DOCTYPE book PUBLIC "-//OASIS//DTD DocBook XML V4.1.2//EN"
                      "http://www.oasis-open.org/docbook/xml/4.0/docbookx.dtd">
<book id="jmol-applet-guide">

  <bookinfo>
    <title>Jmol Applet Documentation</title>
  </bookinfo>

  <chapter>
    <title>Introduction</title>
    <para>
      The Jmol Applet is an offshoot of the main Jmol application, allowing
      the display of 3D chemical information from within any Java 1.1 enabled
      browser.
    </para>
  </chapter>

  <chapter>
    <title>Supported Browsers</title>
    <para>
      The applet is tested and working with Internet Explorer, Netscape,
      Opera, Mozilla (and derivatives) and Konqueror on various platforms.
      Below are given the testing results.
    </para>
    <para>
      If you find problems with the browser/operating system/jvm combination
      of your choice, please send an email to jmol-users@lists.sf.net, stating
      the exact error (most browsers have a Java Console), and the versions
      of the browser, the operating system, and the java virtual machine
      that is used.
    </para>
    <section>
      <title>Testing results</title>
      <para>
        The applet Jmol v6 is tested succesfully with these browsers:
        <informaltable>
          <tgroup cols="4">
            <thead>
              <row>
                <entry>Browser Brand/Version</entry>
                <entry>Operation System/Version</entry>
                <entry>Architecture</entry>
                <entry>JVM Brand/Version</entry>
              </row>
            </thead>
            <tbody>
              <row>
                <entry>IE 6.0</entry>
                <entry>WinME</entry>
                <entry>Intel Pentium</entry>
                <entry>Sun 1.4.1_01</entry>
              </row>
              <row>
                <entry>IE 5.50.4134.0600</entry>
                <entry>Win98</entry>
                <entry>i386</entry>
                <entry>MS JVM 5.00.3309</entry>
              </row>
              <row>
                <entry>IE 5.0.0</entry>
                <entry>Win98</entry>
                <entry>i386</entry>
                <entry>MS JVM 5.00.3805</entry>
              </row>
              <row>
                <entry>Netscape 7.0 rv 1.0.1</entry>
                <entry>SunOS 5.8</entry>
                <entry>Sparc v9</entry>
                <entry>1.4.1</entry>
              </row>
              <row>
                <entry>Netscape 4.79</entry>
                <entry>SunOS 5.8</entry>
                <entry>Sparc v9</entry>
                <entry>1.1.5</entry>
              </row>
              <row>
                <entry>Netscape 4.79</entry>
                <entry>RedHat Linux 8.0</entry>
                <entry>Intel Celeron</entry>
                <entry>Netscape Java 1.1.5</entry>
              </row>
              <row>
                <entry>Opera 7.0 (b2345)</entry>
                <entry>Win98</entry>
                <entry>i386</entry>
                <entry>Sun 1.4</entry>
              </row>
              <row>
                <entry>Mozilla 1.0.1</entry>
                <entry>RedHat Linux 8.0</entry>
                <entry>Intel Celeron</entry>
                <entry>? 1.4.0_01-b03</entry>
              </row>
              <row>
                <entry>Galeon 1.2.5</entry>
                <entry>Debian GNU/Linux Testing</entry>
                <entry>Intel Pentium II</entry>
                <entry>Blackdown 1.3</entry>
              </row>
              <row>
                <entry>Galeon 1.2.6</entry>
                <entry>Debian GNU/Linux Unstable</entry>
                <entry>Intel Pentium4</entry>
                <entry>Sun 1.4.1</entry>
              </row>
              <row>
                <entry>Konqueror 3.0.1</entry>
                <entry>SunOS 5.8</entry>
                <entry>Sparc v9</entry>
                <entry>Sun 1.4.0</entry>
              </row>
              <row>
                <entry>Konqueror 3.0.1</entry>
                <entry>SunOS 5.8</entry>
                <entry>Sparc v9</entry>
                <entry>Sun 1.2.2</entry>
              </row>
            </tbody>
          </tgroup>
        </informaltable>
      </para>
      <para>
        Errors were encountered with these browsers:
        <informaltable>
          <tgroup cols="5">
            <thead>
              <row>
                <entry>Browser Brand/Version</entry>
                <entry>Operation System/Version</entry>
                <entry>Architecture</entry>
                <entry>JVM Brand/Version</entry>
                <entry>Problem</entry>
              </row>
            </thead>
            <tbody>
              <row>
                <entry>Netscape 4.79</entry>
                <entry>RedHat Linux 8.0</entry>
                <entry>Intel Celeron</entry>
                <entry>Netscape Java 1.1.5</entry>
                <entry>1.</entry>
              </row>
              <row>
                <entry>IE 6.0</entry>
                <entry>WinME</entry>
                <entry>Intel Pentium</entry>
                <entry>Microsoft VM 5.0.0.3805</entry>
                <entry>2.</entry>
              </row>
              <row>
                <entry>Galeon 1.2.5</entry>
                <entry>Debian GNU/Linux Stable</entry>
                <entry>Intel Pentium3</entry>
                <entry>Sun 1.4.1</entry>
                <entry>3.</entry>
              </row>
            </tbody>
          </tgroup>
        </informaltable>
        <orderedlist>
          <listitem>
            <para>Verified Error on jmol-applet.jar. Applet was not compiled with a
            <emphasis>classic</emphasis> compiler. This is an compilation problem.
            </para>
          </listitem>
          <listitem>
            <para>Verified Error on cdk-cml.jar. CML lib was not compiled with a
            <emphasis>classic</emphasis> compiler. This is an compilation problem.
            </para>
          </listitem>
          <listitem>
            <para>The environment variable was not recognized by the JVM, which
              in return did not start. This is a OS problem.
            </para>
          </listitem>
        </orderedlist>
      </para>
    </section>
  </chapter>

  <chapter>
    <title>Jmol Applet Usage</title>
    <section>
      <title>Embedding the Jmol Applet in a Web Page</title>
      <para>
        To embed the Jmol Applet in a web page, you need only one
	java archive file, <emphasis>JmolApplet.jar</emphasis>. All classes
	and data files are included in this file. Put this file in the
	directory on your webserver. 
      </para>
      <para>
	The name of the applet class is <emphasis>JmolApplet</emphasis>.
      </para>
      <para>
	The Jmol applet can be embedded in html pages using the 
	<programlisting>APPLET</programlisting> html tag:
        <programlisting><![CDATA[
          <applet code="JmolApplet" archive="JmolApplet.jar"
                  width="350" height="350">
            <param name="load" value="caffeine.xyz">
          </applet>
        ]]></programlisting>
      </para>
      <para>
	CODE identifies the name of the class, in this case 'JmolApplet' or
	'JmolApplet.class'. ARCHIVE identifies the name of the jar file
	where the classes for this applet are to be found. WIDTH and HEIGHT
	specify the dimensions of the applet within the html page in pixels.
      </para>
      <para>
	The PARAM tags are used to pass parameters to the applet. 
	The LOAD parameter specifies the URL of the molecule file which
	should be loaded. 
      </para>
      <para>
	The following is a slightly more complicated version with a few
	more options:
	<programlisting>APPLET</programlisting> html tag:
        <programlisting><![CDATA[
          <applet name="jmol" code="JmolApplet" archive="JmolApplet.jar"
                  width="350" height="350" align="right">
	    <param name="load"    value="molecules/caffeine.xyz">
	    <param name="bgcolor" value="#DDDDFF">
	    <param name="style"   value="quickdraw">
	    <param name="label"   value="symbol">
	    <param name="script"  value="move 0 0 360 0 0 0 0 0 5">
	    <param name="wireframeRotation" value="true">
	    <param name="perspectiveDepth"  value="false">
          </applet>
        ]]></programlisting>
      </para>
      <para>
	In this case the applet is given a name so that it can be referenced
	from JavaScript code (applet="jmol"). The applet is aligned to the
	right side of the page so that text flows to the left (align="right").
	Using additional parameters (&lt;param name="*" value="*"&gt;)
	a molecule is loaded from a relative URL on the web server
	(molecules/caffeine.xyz),
	the background color is set to a light blue (#DDDDFF),
	the style is set so that shaded atoms/bonds are not used (quickdraw),
	atoms are labeled with their atomic symbol (symbol),
	a script is run which rotates 360 degrees around the z axis in 5
	seconds,
	wireframeRotation is turned on so that all movements
	are done in wireframe mode,
	and perspective depth is turned off so that the molecule rendering is
	a flat projection to the screen with no size adjustment for atoms
	and bonds further away from the viewer. 
      </para>
    </section>
    <section>
      <title>Jmol Applet Parameters</title>
      <para>
        The complete list of Jmol Applet parameters is as follows:
        <itemizedlist>
          <listitem>
	    <para>
	      bgcolor - The color of the background: official html
	      color names or #RRGGBB notation
	    </para>
	  </listitem>
          <listitem>
	    <para>
	      style - The rendering style for atoms and bonds:
	      SHADED, WIREFRAME or QUICKDRAW
	    </para>
	  </listitem>
          <listitem>
	    <para>
	      label - The rendering style for atom labels:
	      NONE, SYMBOL or NUMBER
	    </para>
	  </listitem>
          <listitem>
	    <para>
	      wireframeRotation - Rotations use wireframe for faster rendering:
	      TRUE or FALSE (defaults to FALSE)
	    </para>
	  </listitem>
          <listitem>
	    <para>
	      perspectiveDepth - Rotations use wireframe for faster rendering:
	      TRUE or FALSE (defaults to TRUE)
	    </para>
	  </listitem>
          <listitem>
	    <para>
	      script - RasMol/Chime script commands to execute
	    </para>
	  </listitem>
	</itemizedlist>
      </para>
      <section>
        <title>style</title>
        <section>
          <title>shaded</title>
          <para>
	    Renders atoms and bonds as shaded spheres and cylinders. 
	    Shaded images are calculated and cached, so performance
	    should not be an issue except when dealing with very
	    large protein molecules. 
          </para>
        </section>
        <section>
          <title>quickdraw</title>
          <para>
	    Renders atoms and bonds as flat, solid-colored circles
	    and rectangles. 
          </para>
        </section>
        <section>
          <title>wireframe</title>
          <para>
	    Atoms are drawn as unfilled circles. Bonds are drawn as
	    single lines. 
          </para>
          <para>
	    Note: If rendering performance is unacceptably slow when dealing
	    with very large molecules, the WIREFRAMEROTATION option can be
	    used to switch to wireframe mode during rotations and translations.
          </para>
        </section>
      </section>
      <section>
        <title>Atom Labels</title>
        <section>
          <title>none</title>
          <para>
            View the atoms without any label. This is the default. 
          </para>
        </section>
        <section>
          <title>symbol</title>
          <para>
            Label the atoms with their element symbol. 
          </para>
        </section>
        <section>
          <title>number</title>
          <para>
            Label the atoms with their index number. 
          </para>
        </section>
      </section>
    </section>
    <section>
      <title>script</title>
      <para>
	The script parameter allows you to specify a script of
	RasMol/Chime commands to be executed after the molecule file
	is loaded.
      </para>
      <para>
	Multiple script commands can be separated by the semicolon (;)
	character.
      </para>
    </section>
  </chapter>
  <chapter>
    <title>JavaScript integration</title>
    <para>
      Using JavaScript commands embedded in web pages, you can control
      the behavior of the Jmol applet. This flexibility enables you to
      create complex user interactions that are controlled using standard
      web page elements.
    </para>
    <section>
      <title>Web Browser support</title>
      <para>
	The underlying technology that supports this is known as LiveConnect.
	The LiveConnect layer provides the data and method conversion interface
	between the JavaScript world and the Java world.
      </para>
      <para>
	Netscape and Internet Explorer have both supported LiveConnect for
	some time.
      </para>
      <para>
	The Konqueror browser does not yet support LiveConnect.
      </para>
      <para>
	Unfortunately, the news is not good for Macintosh OS X. Internet
	Explorer does not support LiveConnect.
	Neither does Safari (which is based upon Konqueror).
	(I have not yet checked Netscape on OS X.)
      </para>
    </section>
    <section>
      <title>JavaScript LiveConnect overview</title>
      <para>
	In order to reference an applet on an HTML page the applet must
	be given a name. We recommend that you use the name 'jmol' as in:
        <programlisting><![CDATA[
          <applet name="jmol" code="JmolApplet" archive="JmolApplet.jar"
                  width="350" height="350">
            <param name="load" value="caffeine.xyz">
          </applet>
        ]]>
	</programlisting>
      </para>
      <para>
	If you would like to have multiple instances of the applet on a
	single page then you should give them unique names.
      </para>
      <para>
	With some browser versions you can sneak by without starting object
	references with 'document'. However, this does not work with many
	browsers. Therefore, we strongly recommend that you start all
	your references with 'document'.
      </para>
      <para>
	Therefore, assuming you have named your applet 'jmol', all your
	references to the applet will start with 'document.jmol'. JavaScript
	method references in this documentation will use this notation. 
      </para>
      <para>
	Within a web page, there are several ways to invoke a JavaScript
	method based upon user events. One method is to use the
	'javascript:' protocol in an href, as in:
        <programlisting><![CDATA[
          <a href="javascript:document.jmol.load('dna.xyz')">
	    Load DNA molecule
	  </a>
        ]]>
	</programlisting>
      </para>
      <para>
	Another method is to use explicit JavaScript event tags, as in:
        <programlisting><![CDATA[
	  <form name="myform">
	    <input type="button" value="Rotate X 90"
	      onClick="document.jmol.script('rotate x 90')">
	    <input type="button" value="Rotate Y 90"
	      onClick="document.jmol.script('rotate y 90')">
	    <input type="button" value="Rotate Z 90"
	      onClick="document.jmol.script('rotate Z 90')">
          </form>
        ]]>
	</programlisting>
      </para>
      <para>
	For further information on JavaScript programming we recommend
	that you search for JavaScript development resources on the web
	or at your nearest technical bookstore.
      </para>
      <para>
        To get things to run on an installed base of older Netscape and
	IE browsers you may want to consider looking for 'old' documentation
	rather than 'up to date' documentation. One good reference source is
	http://developer.netscape.com/docs/manuals/js/client/jsguide/index.html	
      </para>
    </section>
    <section>
      <title>Jmol JavaScript API</title>
      <section>
	<title>document.jmol.load(String url)</title>
	<para>
	  The 'load' method allows you to load a different molecular
	  model into the applet.
	</para>
      </section>
      <section>
	<title>document.jmol.loadInline(String model)</title>
	<para>
	  At times it may be more convenient to store the contents
	  of the molecular model as a string in the HTML file itself.
	  The 'loadInline' method allows you to load a molecular model
	  of this type.
	</para>
      </section>
      <section>
	<title>document.jmol.setStyle(String style)</title>
	<para>
	  Set the atom/bond rendering style to one of 'SHADED',
	  'QUICKDRAW' or 'WIREFRAME'
	</para>
      </section>
      <section>
	<title>document.jmol.setLabelStyle(String labelStyle)</title>
	<para>
	  Set the atom label to be one of 'NONE', 'SYMBOL' or 'NUMBER'
	</para>
      </section>
      <section>
	<title>document.jmol.setWireframeRotation(boolean wfrMode)</title>
	<para>
	  Controls whether or not rotations should be performed with
	  wireframe rendering. This should not be needed except on
	  very large molecules (or very old computers).
	</para>
      </section>
      <section>
	<title>document.jmol.setPerspectiveDepth(boolean pdMode)</title>
	<para>
	  By default, atoms are rendered with perspective depth. That is,
	  objects further away are smaller. When perspective depth is set
	  to false you get a flat projection which is orthogonal to the
	  screen. 
	</para>
	<para>
	  The different projection modes are easily visible with
	  crystaline structures or when the enclosing boundbox is
	  turned on, as in:
	  <programlisting>
	    document.jmol.script('set boundbox on');
	  </programlisting>
	</para>
      </section>
    </section>
  </chapter>
</book>
