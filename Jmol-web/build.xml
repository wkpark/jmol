<project default="html" basedir=".">

  <property name="version" value="10.00" />
  <property name="jmol-doc-dir" value="../Jmol-HEAD" />
  <property name="doc.dir" value="source/doc" />
  <property name="build.dir" value="build" />
  <property name="build.html" value="${build.dir}/html" />

  <target name="clean">
    <delete dir="${build.dir}"/>
  </target>

  <target name="spotless" depends="clean">
  </target>

  <!-- Building web site -->
  <target name="html" depends="clean" >
  	
  	<!-- Directory creation -->
    <mkdir    dir="${doc.dir}/images"/>
    <mkdir    dir="${build.html}"/>

    <!-- Copy files from Jmol history -->
  	<copy todir="${doc.dir}/changes" overwrite="yes">
      <fileset dir="${jmol-doc-dir}/doc/source/history" includes="**/*"/>
    </copy>

    <!-- Generate index html files for each language -->
  	<antcall target="html_lang">
  	  <param name="lang_value" value="en"/>
  	</antcall>
  	<antcall target="html_lang">
  	  <param name="lang_value" value="fr"/>
  	</antcall>
  	
    <!-- Copy other files -->
    <copy todir="${build.html}" overwrite="yes"> 
      <fileset dir="${doc.dir}" includes="license.txt,document.dtd"/>
    </copy>
    <copy todir="${build.html}" overwrite="yes">
      <fileset dir="${doc.dir}"
               excludes="**/*.xml,**/*.xsl,**/*~,**/cache.properties"/>
    </copy>
  	<copy todir="${build.html}/fah" overwrite="yes"
  		  file="${doc.dir}/fah/fah-projects.xml" />

    <!-- Copy files from Jmol docs -->
  	<copy todir="${build.html}/docs" overwrite="yes">
      <fileset dir="${jmol-doc-dir}/build/doc" includes="**/*"/>
    </copy>

    <!-- Replace content of files with variables -->
    <replace dir="${build.html}" includes="**/*.html">
      <replacefilter token="$$VERSION$$" value="${version}"/>
    </replace>

  	<!-- Replace paths -->
    <replace dir="${build.html}" includes="*.html">
      <replacefilter token="[images]"   value="images" />
      <replacefilter token="[root]"     value="." />
      <replacefilter token="[codebase]" value="jmol" />
    </replace>
    <replace dir="${build.html}" includes="*/*.html">
      <replacefilter token="[images]"   value="../images" />
      <replacefilter token="[root]"     value=".." />
      <replacefilter token="[codebase]" value="../jmol" />
    </replace>

  	<!-- Modify access rights -->
    <chmod perm="ug=rw,o=r" dir="${build.html}" includes="**/*" />
  </target>

  <!-- Language dependent target -->
  <target name="html_lang">

    <!-- Generate index.<lang>.html files -->
    <style
      basedir="${doc.dir}"
      destdir="${build.html}"
      style="${doc.dir}/style.xsl"
      includes="**/index_${lang_value}.xml">
      <mapper type="glob" from="*_${lang_value}.xml" to="*.${lang_value}.html"/>
      <param name="lang" expression="${lang_value}"/>
      <param name="project_xml" expression="project_${lang_value}.xml"/>
    </style>

  </target>

</project>
