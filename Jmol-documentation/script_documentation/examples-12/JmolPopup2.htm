<html height="100%">
<head>
<title>Jmol Popup Model</title>
<script type="text/javascript" src="JmolCore.js"></script>
<script type="text/javascript" src="JmolApplet.js"></script>
<script type="text/javascript" src="JmolControl.js"></script>
<script type="text/javascript" src="JmolApi.js"></script>
<script type="text/javascript">

// note: version 2 requires &ID=... if the applet is not named "jmol" and there are > 1 applets

theScript = document.location.search
function getStateJME() {
	name = document.location.search.substring(1)
	var data = "load inline '" + opener.document.getElementById(name).jmeFile() + "'"
	return data
}
isJME = (theScript.indexOf("?JME") == 0)
isDRAG = (theScript.indexOf("&DRAG") >= 0)
isSIGNED = (theScript.indexOf("SIGNED") >= 0)
appletID = (theScript.indexOf("ID=") >= 0 ? theScript.split("ID=")[1].split("&")[0] : null)
theScript = (isJME ? getStateJME() 
	: theScript.indexOf("script=") >= 0 ? unescape(theScript.split("script=")[1].split("&")[0])
	: 0)

function refreshModelX(){
	
}

function getState(){
	if (isJME)theScript = getStateJME() 
	if (theScript)
		return theScript + getDragState()
	if (!opener) {
	  alert("The page that opened this pop-up window is not available.")
	  return ""
	}
	if (opener.Jmol && !appletID)
		appletID = opener.Jmol._lastAppletID
	return 
	(isJME ? getStateJME() 
		: opener.jmolGetPropertyAsString ? opener.jmolGetPropertyAsString("stateInfo")
		: opener.Jmol.getPropertyAsString(appletID, "stateInfo")
	) + getDragState() 
}

function doAlert(){
	if (theScript)
		alert("just reload this page to reset the model")
	else
		alert('Click on "refresh model" at any time to see the model in its current state in this window. You may refresh the model as often as desired, and you may resize this model as often as you like.')
}

function getDragState() {
 return ";set picking " + (document.getElementById("chkDrag").checked ? "dragMinimize;" : "identify;")
}

function checkDragMode() {
  jmolScript(getDragState())
}

function getDragCheck() {
 document.write('<label><input type="checkbox" id="chkDrag" onclick="checkDragMode()" ' + (isDRAG ? "checked" : "") + '>drag-minimize mode</label>')

}

jmol = "jmol"

</script>

</head>
<body height="100%">
<h3>
 <a href="javascript:Jmol.script(jmol, getState());checkDragMode()">refresh model</a>
 <a href="javascript:doAlert()">note</a>
</h3>
<script type="text/javascript">

var Info = {
	width: "100%",
	height: "85%",
	script: theScript,
	useNoApplet: false,
	useJmolOnly: true,
	useWebGlIfAvailable: false,
	useImageOnly: false,
	jarPath: ".",
	jarFile: isSIGNED ? "JmolAppletSigned.jar" : "JmolApplet.jar",
	isSigned: isSIGNED,
	addSelectionOptions: false,
	serverURL: "http://chemapps.stolaf.edu/jmol/jmolcd2.php",
	readyFunction: null,
	defaultModel: null,
	debug: false
}


jmol = Jmol.getApplet(jmol, Info)
</script>
<br />
<table width="100%"><tr><td align=left>
<script type="text/javascript">getDragCheck()</script>
</td><td align=right><a href="javascript:Jmol.script(jmol,'center visible;set zoomlarge false;zoom 90')">recenter model</a>
</td></tr></table>

 </body>
</html>