<project default="html" basedir=".">

  <property name="version" value="8" />
  <property name="applet-version" value="8" />
  <property name="jmol-dir" value="../Jmol-b6" />
  <property name="doc.dir" value="source/doc" />
  <property name="build.dir" value="build" />
  <property name="build.html" value="${build.dir}/html" />

  <target name="clean">
    <delete dir="${build.dir}"/>
  </target>

  <target name="spotless" depends="clean">
  </target>

  <target name="html" depends="clean" >
    <mkdir    dir="${doc.dir}/images"/>
    <mkdir    dir="${doc.dir}/jmol"/>
    <mkdir    dir="${build.html}"/>
    <style basedir="${doc.dir}"
      destdir="${build.html}"
      style="${doc.dir}/style.xsl"
      includes="**/*.xml"
      excludes="project.xml"
    />
    <copy todir="${build.html}" overwrite="yes"> 
      <fileset dir="${doc.dir}" includes="license.txt,document.dtd"/>
    </copy>
    <copy todir="${build.html}" overwrite="yes">
      <fileset dir="${doc.dir}"
               excludes="**/*.xml,**/*.xsl,**/*~" />
    </copy>
    <copy todir="${build.html}/jmol" overwrite="yes">
      <fileset dir="${jmol-dir}" includes="JmolApplet.jar" />
      <fileset dir="${jmol-dir}/appletweb" includes="JmolApplet.properties" />
    </copy>
    <copy todir="${build.html}/docs" overwrite="yes">
      <fileset dir="${jmol-dir}/build/doc" includes="**/*" />
    </copy>

    <replace dir="${build.html}" includes="**/*.html">
      <replacefilter token="$$VERSION$$" value="${version}"/>
      <replacefilter token="$$APPLET-VERSION$$" value="${applet-version}"/>
    </replace>

    <replace dir="${build.html}" includes="*.html">
      <replacefilter token="[images]"   value="images" />
      <replacefilter token="[root]"     value="." />
      <replacefilter token="[codebase]" value="jmol" />
    </replace>

    <replace dir="${build.html}" includes="*/*.html">
      <replacefilter token="[images]"   value="../images" />
      <replacefilter token="[root]"     value=".." />
      <replacefilter token="[codebase]" value="../jmol" />
    </replace>

    <chmod perm="ug=rw,o=r" dir="${build.html}" includes="**/*" />

  </target>
</project>

