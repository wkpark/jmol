<!DOCTYPE html>
<html>
<head>
<title>Slider control for Anything</title>
<script type="text/javascript" src="scroller.js"></script>
<script src="../jsmol/JSmol.min.js" type="text/javascript"></script>
<script type="text/javascript">

//jmolinitialize("../..", "JmolAppletSigned.jar")

script0 = "load 3hyd.pdb;wireframe only;wireframe 0.1;boundbox scale 1.2 {tyr};zoomto 2 {tyr} 0;set drawhover on;"

MInfo = {
  j2sPath: "../../jsmol/j2s",
  use: "HTML5",
  width: 500,
  height: 500,
  script: script0,
	disableInitialConsole: true
}

$(document).ready(function(){
	Jmol.setDocument(0);
  $("#jmoldiv").html(Jmol.getAppletHtml("jmol",MInfo));
  var s = Jmol.jmolCheckbox(jmol, "wireframe -0.1", "wireframe off", "wireframe",true)
		+ Jmol.jmolRadio(jmol, [dobtn,"cloudonly"],"cloud",false, " ", "render")
		+ Jmol.jmolRadio(jmol, [dobtn,"meshonly"],"mesh",false, " ", "render")
		+ Jmol.jmolRadio(jmol, [dobtn,"alloff"],"none",true, " ", "render")
		+ Jmol.jmolBr()
		+ Jmol.jmolHtml("background ")
		+ Jmol.jmolLink(jmol, "background white", "white")
		+ Jmol.jmolHtml(" ")
		+ Jmol.jmolLink(jmol, "background black", "black")
//jmolCheckbox([dobtn,"cloudon"], [dobtn, "cloudoff"], "cloud", false)
//jmolCheckbox([dobtn,"meshon"], [dobtn, "meshoff"], "mesh", false)
		+ newScroller("cutoff","cutoff: " + thisCutoff,"doScroll",300,-1,-1,false,0,5,thisCutoff,1, "mouseup");
	$("#buttondiv").html(s);

	initScrollers();
	//$("#jmolform")[0].reset();

});

color = "yellow"
colorscheme = "colorscheme translucent bw"
id = "imesh"

Cmds = {
	"cutoff": 'set echo top left;echo processing...;refresh;isosurface id ID boundbox color COLOR cutoff CUTOFF  COLORSCHEME "3hyd_map.ccp4.gz" mesh nofill;echo "" '
}

Info = []

function doScroll(name, value, position) {
	value = Math.floor(value * 10)/10
	Info = [name,value] 
	if (name == "cutoff")thisCutoff = value
	document.getElementById("scr_" + name + "_caption").innerHTML = name + ": " + value
	doCmd()
}

function dobtn(element,data,target) {
	Info = [data[1]]
	doCmd()
}

meshon = false
cloudon = false
meshok = false
cloudok = false
thisCutoff=1.6

mtime = 0

function doCmd(info) {
	if (!info)info = Info
	Info=[]
	if (info.length == 0)return
	var name = info[0]
//document.getElementById("test").innerHTML += "<br>" + mtime + " " + name + " " + (cloudon?"T":"F") + " " + (cloudok?"T":"F") + "/" + (meshon?"T":"F") + " " + (meshok?"T":"F")
	switch(name){
	case "cutoff":
		if (mtime)clearTimeout(mtime)
		mtime=setTimeout('doCmd(["cutoff1"])',500)
		break;
	case "cutoff1":
		meshok = false
		cloudok = false
		if (meshon)doCmd(["meshon"])
		if (cloudon)doCmd(["cloudon"])
		break;
	case "meshonly":
		doCmd(["cloudoff"])
		doCmd(["meshon"])
		break;
	case "meshon":
		if (meshok)
			runScript("display $~mesh ")
		else
			runCommand("cutoff","ID","~mesh","COLOR","yellow","CUTOFF",thisCutoff,"COLORSCHEME","")
		meshon = true
		meshok = true
		break;
	case "meshoff":
		if (meshon)runScript("hide $~mesh")
		meshon = false
		break;
	case "cloudonly":
		doCmd(["meshoff"])
		doCmd(["cloudon"])
		break;
	case "cloudon":
		if (cloudok) {
			runScript("display $~cloud")
		} else {
			runCommand("cutoff","ID","~cloud","COLOR","density","CUTOFF",thisCutoff,"COLORSCHEME",colorscheme)
		}
		cloudon = true
		cloudok = true
		break;
	case "cloudoff":
		if (cloudon)runScript("hide $~cloud")
		cloudon = false
		break;
	case "alloff":
		doCmd(["meshoff"])
		doCmd(["cloudoff"])
		break;
	}
}

function runScript(script) {	
	Jmol.script(jmol, script)
}

function runCommand(name) {
	var script = Cmds[name]
	for (var i = 1; i < arguments.length; i++) {
		var r = new RegExp(arguments[i])
		script = script.replace(r,arguments[++i])
	}
//alert(script)
	runScript(script)
}


</script>
</head>

<body>
<table><tr><td>
<div id="jmoldiv"></div>

<br>

<form id=jmolform>
<div id="buttondiv"></div>
</form>

</td><td>This page demonstrates a couple of features of Jmol. First, its capability to display electron density isosurfaces and "clouds". 
Note that apparently Java does not cache file loads from Jmol, so don't expect instantaneous action here. 
Second, a simple little slider system. This is derived from another project I worked on; it is set up to register the value when you slide
but only act on it when you release the mouse. Not tested on Macs.
<div id=test></div>
</body>
</html>
