<chapter>
<title>Scripting Commands</title>
<para>
  Scripting commands are the same under the JmolApplet as under the Jmol
  application. However, with the applet you do not have the feedback of
  the script command window.
</para>
<section>
  <title>Scripting References</title>
  <para>
    Jmol implements almost all scripting commands found in the
    RasMol mole molecular visualization tool. At this time, the
    primary reference for the scripting language is the
    RasMol documentation. It can be found on the web at
    <ulink url="http://www.openrasmol.org/doc/">
      http://www.openrasmol.org/doc/
    </ulink>
  </para>
  <para>
    <emphasis> If you are not familiar with the RasMol scripting
    language, we </emphasis>strongly<emphasis> recommend that you
    become familiar with this document.</emphasis>
  </para>
  <para>
    MDL extended the RasMol scripting language for use in their
    Chime plug-in. Jmol implements some of these script language
    extensions. For more detailed information on Chime and Chime/RasMol
    extensions see
    <ulink url="http://www.mdlchime.com/chime/">
      http://www.mdlchime.com/chime/
    </ulink>
  </para>
  <para>
    In some areas, Jmol has extended these RasMol/Chime commands
    to offer additional functionality. Detailed documentation
    has not been written yet :-(
  </para>
</section>
<section>
  <title>Ways to integrate scripts</title>
  <para>
    There are two methods of defining a script to be run by the applet
  </para>
    <itemizedlist>
      <listitem>
	<para>by using the parameter="script" tag as part of the applet specification</para>
      </listitem>
      <listitem>
	<para>by using the JavaScript script('script-commands') method</para>
      </listitem>
    </itemizedlist>
    <para>In either of these cases you can</para>
    <itemizedlist>
      <listitem>
	include the entire script in the html page
      </listitem>
      <listitem>
	use the <command>script [scriptname]</command>
	command to load a script from the webserver
      </listitem>
    </itemizedlist>
    <para>
      In general, the first of these methods is only acceptable for short
      scripts.
      For longer scripts it is probably better to store the script files
      on the server and run them indirectly through the 'script' command. 
    </para>
</section>
<section>
  <title>Examples</title>
  <para>
    All of the following examples load the molecule caffeine.xyz.
    The examples also assume that the JmolApplet.jar file is
    located in the same directory as the .html page.
    Various ways of invoking scripts are demonstrated
  </para>
  <para>
    A short script included as an applet parameter which is executed
    as soon as the applet is loaded.
    <programlisting><![CDATA[
      <html>
        <head><title>Example 1</title></head>
	<body>
          <applet name="jmol" code="JmolApplet" archive="JmolApplet.jar"
                  width="350" height="350">
     	    <param name="progressbar"   value="true" />
	    <param name="progresscolor" value="blue" />
	    <param name="boxmessage"    value="Loading Jmol ..." />
	    <param name="boxbgcolor"    value="black" />
	    <param name="boxfgcolor"    value="white" />  
	
	    <param name="load"          value="caffeine.xyz" />
	    <param name="script"        value="rotate x 90 ; background yellow">
          </applet>
	</body>
      </html>
      ]]>
    </programlisting>
  </para>
  <para>
    In this example, the <command>script</command> command is used
    to execute a longer script which is stored in the scripts
    subdirectory on the web server.
    <programlisting><![CDATA[
      <html>
        <head><title>Example 2</title></head>
	<body>
          <applet name="jmol" code="JmolApplet" archive="JmolApplet.jar"
                  width="350" height="350">
     	    <param name="progressbar"   value="true" />
	    <param name="progresscolor" value="blue" />
	    <param name="boxmessage"    value="Loading Jmol ..." />
	    <param name="boxbgcolor"    value="black" />
	    <param name="boxfgcolor"    value="white" />  
	
	    <param name="load"          value="caffeine.xyz" />
	    <param name="script"        value="script scripts/myLongScript.txt">
          </applet>
	</body>
      </html>
      ]]>
    </programlisting>
  </para>
  <para>
    This example uses <command>onLoad</command> to execute JavaScript which,
    in turn, drives the applet. 
    <programlisting><![CDATA[
      <html>
	<head><title>Example 3</title></head>
        <body onLoad="document.jmol.script('select carbon; color green')">
	  <applet name="jmol" code="JmolApplet" archive="JmolApplet.jar"
	    width="350" height="350">
     	    <param name="progressbar"   value="true" />
	    <param name="progresscolor" value="blue" />
	    <param name="boxmessage"    value="Loading Jmol ..." />
	    <param name="boxbgcolor"    value="black" />
	    <param name="boxfgcolor"    value="white" />  
	
	    <param name="load"          value="caffeine.xyz">
	  </applet>
	</body>
      </html>
      ]]>
    </programlisting>
  </para>
  <para>
    Essentially the same thing, but loading a script off of the web server. 
    <programlisting><![CDATA[
      <html>
	<title>Example 4</title>
	<body onLoad="document.jmol.script('script scripts/myLongScript.txt')">
	  <applet name="jmol" code="JmolApplet" archive="JmolApplet.jar"
	    width="350" height="350">
     	    <param name="progressbar"   value="true" />
	    <param name="progresscolor" value="blue" />
	    <param name="boxmessage"    value="Loading Jmol ..." />
	    <param name="boxbgcolor"    value="black" />
	    <param name="boxfgcolor"    value="white" />  
	
	    <param name="load"          value="caffeine.xyz">
	  </applet>
	</body>
      </html>
      ]]>
    </programlisting>
  </para>
  <para>
    Calling a javascript function which controls the script.
    <programlisting><![CDATA[
      <html>
	<title>Example 5</title>
	<script>
	  function runMyScript() {
	    document.jmol.script('move 0 0 360 0 0 0 0 0 4');
	  }
	</script>
	<body onLoad="runMyScript()">
	  <applet name="jmol" code="JmolApplet" archive="JmolApplet.jar"
	    width="350" height="350">
     	    <param name="progressbar"   value="true" />
	    <param name="progresscolor" value="blue" />
	    <param name="boxmessage"    value="Loading Jmol ..." />
	    <param name="boxbgcolor"    value="black" />
	    <param name="boxfgcolor"    value="white" />  
	
	    <param name="load"          value="caffeine.xyz">
	  </applet>
	</body>
      </html>
      ]]>
    </programlisting>
  </para>
  <para>
    Using buttons to call javascript methods, each of which is
    running a jmol script. 
    <programlisting><![CDATA[
      <html>
	<title>Example 6</title>
	<script>
	  function rotateX() {
	    document.jmol.script('move 360 0 0 0 0 0 0 0 4');
	  }
	  function rotateY() {
	    document.jmol.script('move 0 360 0 0 0 0 0 0 4');
	  }
	  function rotateZ() {
	    document.jmol.script('move 0 0 360 0 0 0 0 0 4');
	  }
	</script>
	<body>
	  <applet name="jmol" code="JmolApplet" archive="JmolApplet.jar"
	    width="350" height="350">
     	    <param name="progressbar"   value="true" />
	    <param name="progresscolor" value="blue" />
	    <param name="boxmessage"    value="Loading Jmol ..." />
	    <param name="boxbgcolor"    value="black" />
	    <param name="boxfgcolor"    value="white" />  

	    <param name="load"          value="caffeine.xyz">
	  </applet>
	  <form>
	    <input type="button" value="rotate x" onClick="rotateX()"/>
	    <input type="button" value="rotate y" onClick="rotateY()"/>
	    <input type="button" value="rotate z" onClick="rotateZ()"/>
	  </form>
	</body>
      </html>
      ]]>
    </programlisting>
  </para>
  <para>
    Using buttons to call javascript methods, each of which is
    driving a jmol animate script
    <programlisting><![CDATA[
    <html>
      <title>Example 7</title>
        <script>
	  function play(script) {
	    document.jmol.script(script);
	  }
	</script>
	<body>
	  <applet name="jmol" code="JmolApplet" archive="JmolApplet.jar"
                  width="350" height="350">
     	    <param name="progressbar"   value="true" />
	    <param name="progresscolor" value="blue" />
	    <param name="boxmessage"    value="Loading Jmol ..." />
	    <param name="boxbgcolor"    value="black" />
	    <param name="boxfgcolor"    value="white" />  

            <param name="load"          value="models/SN1_reaction.xyz">
          </applet>
          <form>
            <input type="button" value="next"
	           onClick="play('animate next')">
            <input type="button" value="prev"
	           onClick="play('animate prev')">
            <input type="button" value="rewind"
	           onClick="play('animate rewind')">
            <input type="button" value="play"
	           onClick="play('animate play')">
            <input type="button" value="revplay"
	           onClick="play('animate revplay')">
            <br>
            <input type="button" value="repeated with 2 second delay"
                   onClick="play('animate play; loop 2')">
            <br>
            <input type="button" value="repeated no delay"
                   onClick="play('animate play; loop 0')">
            <br>
            <input type="button" value="forward and reverse"
                   onClick="play('animate play; animate revplay; loop 0')">
          </form>
        </body>
      </html>
      ]]>
    </programlisting>
  </para>
</section>
</chapter>
