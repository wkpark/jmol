<!--
/* $RCSfile$
 * $Author$
 * $Date$
 * $Revision$
 * A few changes by aHerraez 1-4 oct. 2008: 
 *		- fix: no message was being shown for compatible browsers
 *		- more user-friendly browser name and OS name displayed
 *
 * Copyright (C) 2004-2008  The Jmol Development Team
 *
 * Contact: jmol-developers@lists.sf.net
 *
 *  This library is free software; you can redistribute it and/or
 *  modify it under the terms of the GNU Lesser General Public
 *  License as published by the Free Software Foundation; either
 *  version 2.1 of the License, or (at your option) any later version.
 *
 *  This library is distributed in the hope that it will be useful,
 *  but WITHOUT ANY WARRANTY; without even the implied warranty of
 *  MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU
 *  Lesser General Public License for more details.
 *
 *  You should have received a copy of the GNU Lesser General Public
 *  License along with this library; if not, write to the Free Software
 *  Foundation, Inc., 59 Temple Place, Suite 330, Boston, MA
 *  02111-1307  USA.
 */
-->
<html>
  <head>
    <title>Jmol Browser Check</title>
    <script type="text/javascript" src="../jmol/Jmol.js"></script>
  </head>
  <body>
    <img src="../images/Jmol_smallLogo.jpg" />
    <hr />
    <h1>Jmol Browser Check</h1>
    <h2>Background information:</h2>
    <blockquote>
    <p>
      The Jmol applet requires a web browser that supports Java applets.
    </p>
    <p>
      In addition, most web pages using the Jmol applet
      include HTML controls (buttons,
      checkboxes, etc.) that send scripts to control the Jmol applet.
      In order for these controls to function properly the web browser
      must also support JavaScript and LiveConnect communications
      between JavaScript and Java applets.
    </p>
    </blockquote>

    <h2>
      Results of testing your browser:
    </h2>
    <script type="text/javascript">
      var msgNetscape47Win = 
      "<p>While Jmol generally supports Netscape 4.7 on Windows, there are <b>some " +
      "small problem</b> areas related to mouse events and occasional " +
      "JavaScript/LiveConnect issues. </p>" +
      "<p>In addition, the state of the applet does not get reset when " +
      "a web page gets reloaded, sometimes causing html checkboxes " +
      "and radio buttons to be out of synch with the applet appearance. </p>" +
      "<p>We <b>recommend</b> that you consider upgrading " +
      "to a newer web browser. </p>";

      var msgNoGetElementById =
      "<p>This seems to be an older web browser that does not support " +
      "current browser standards. Jmol and/or the buttons to control Jmol " +
      "probably <b>will not function properly</b> with this browser. We <b>recommend</b> " +
      "that you upgrade to a newer web browser. </p>";

      var msgGenericNoJava =
      "<p>Your web browser reports that Java is not enabled. " +
      "The Jmol applet <b>requires</b> Java support from your web browser.<br />" +
      "Please <b>configure</b> your browser to enable java applets and/or <b>download</b> Java from " +
      "<a href='http://www.java.com' target='_blank'>www.java.com " +
      "<img border='0' src='get_java_red_button.gif' /></a>." +
      "</p>";

      var msgGenericOK =
      "<p>Your web browser seems to <b>properly support</b> Jmol. </p>" +
      "<p>If you do encounter problems please report them to " +
      "<code>jmol-developers@lists.sf.net</code></p>";

      var msgNoLiveConnectMac =
      "<p>The Jmol applet itself <b>will function properly</b>. " +
      "However, web pages constructed with HTML controls such as " +
      "buttons, checkboxes, and links <b>will not function properly</b> because " +
      "the controls cannot send the script commands to the Jmol applet.</p>" +
      "<p>We <b>recommend</b> that you consider using Safari or another " +
      "Macintosh browser that supports LiveConnect communications between " +
      "JavaScript and Java applets.</p>";

      var msgMacIE =
      "<p>Microsoft Internet Explorer on Macintosh <b>does not support</b> " +
      "LiveConnect communications between JavaScript and Java applets. </p>";

      var msgMacOldSafari =
      "<p>Older versions of Safari <b>do not support</b> " +
      "LiveConnect communications between JavaScript and Java applets. </p>";

      var msgMacMozillaOldJava =
      "<p>Netscape/Mozilla/FireFox on Macintosh do not have access to " +
      "the latest Java release and therefore <b>do not support</b> LiveConnect " +
      "communications between JavaScript and Java applets. </p>";

      var msgMacMozillaAlternative =
      "<p>Or, <b>you can try</b> installing and using the Macintosh OS X Java "+
      "Plug-in from" +
      "<a href='http://javaplugin.sourceforge.net' target='_blank'>" +
      "javaplugin.sourceforge.net</a>";

      var msgMacOpera754OrLess =
      "<p>This version of Opera on Macintosh seems to have <b>problems</b> " +
      "running applets. </p>" +
      "We <b>recommend</b> that you consider using Safari or another " +
      "Macintosh browser that reliably runs Java applets and has " +
      "LiveConnect communications between JavaScript and Java applets. </p>";

      var msgLinuxKonqueror331OrLess =
      "<p>All version of Konqueror on Linux/Unix up through 3.3.1 have " +
      "<b>bugs</b> in java applet support. " +
      "The Jmol team has filed bug reports with the Konqueror team and " +
      "the Konqueror team is addressing them.</p>" +
      "<p>A newer version of Konqueror newer than 3.3.1 " +
      "may have fixed the problem. Or, " +
      "you can use a Mozilla family browser.</p>";

      var msgOK =
      "<p>Your browser seems <b>compliant</b> with Jmol.</p>" +
      "<p>If you do experience problems with Jmol running in your browser " +
      " please report them to " +
      "<code>jmol-developers@lists.sf.net</code></p>";

      var msg = "";
      var mozillaVersion = "";
      var javaVersion = 0;
      var state = "yellow";

      with (_jmol) {
		if (browser == "mozilla" && browserVersion >= 5) {
			var indexRV = ua.indexOf("rv:");
			if (indexRV > 0) {
				var rv = ua.substring(indexRV + 3);
				var indexEnd = rv.indexOf(")");
				var indexSemi = rv.indexOf(";");
				if (indexEnd < 0 || (indexSemi > 0 && indexSemi < indexEnd))
				  indexEnd = indexSemi;
				if (indexEnd > 0)
				  mozillaVersion = " " + rv.substring(0, indexEnd);
			}
		}
		do {
			if (isNetscape47Win)
			{ msg = msgNetscape47Win; break; }
			if (os == "mac" && browser == "mozilla" && browserVersion >= 5) {
				eval("try{javaVersion=" +
				 "java.lang.System.getProperty('java.version');" +
				 "} catch (e) { }");
				if (javaVersion < 1.4) {
					msg = msgMacMozillaOldJava + msgNoLiveConnectMac +
					msgMacMozillaAlternative;
					break;
				}
			}
			if (! isJavaEnabled)
			{ msg = msgGenericNoJava; state = "red"; break; }
			if (! hasGetElementById)
			{ msg = msgNoGetElementById; state = "red"; break; }
			if (os == "mac" && browser == "msie")
	    	{ msg = msgMacIE + msgNoLiveConnectMac; break; }
	  		if (os == "mac" && browser == "safari" && browserVersion < 125.1)
	    	{ msg = msgMacOldSafari + msgNoLiveConnectMac; break; }
	  		if (os == "mac" && browser == "opera" && browserVersion <= 7.54)
	    	{ msg = msgMacOpera754OrLess; state = "red"; break; }
	  		if ((os == "win" && browser == "msie") ||
	      		(os == "win" && browser == "mozilla" && browserVersion >= 5) ||
	      		(os == "win" && browser == "opera" && browserVersion >= 7.54) ||
	      		((os == "linux" || os == "unix") &&
	       		browser == "mozilla" && browserVersion >= 5))
	    	{ state = "green"; break; }
	  		if ((os == "linux" || os == "unix") &&
	      		browser == "konqueror" && browserVersion <= 3.3)
	    	{ msg = msgLinuxKonqueror331OrLess; state = "red"; break; }
        } while (false); // this 'loop' is here only to allow use of 'break'

	    var osString = os;	/* for a more meaningful display */
		if (osString=="win") { osString = "Windows" }
		else if (osString=="linux") { osString = "Linux" }
		else if (osString=="unix") { osString = "Unix" }
		else if (osString=="mac") { osString = "MacOS" }

		var browserString;
		var Ffox = navigator.userAgent.indexOf("Firefox");
		if ( browser=="mozilla")
		{	/* Mozillas are always Mozilla/5; the browserVersion=5 is hence irrelevant as version nr. 
				All details are shown in UA anyway, so I'll put here the most user-friendly string */
			if (Ffox!=-1)
			{	browser = "Firefox";
				browserVersion = navigator.userAgent.substring(Ffox + "Firefox/".length);
				browserString = browser + " " + browserVersion;
			}
			else
			{	browserVersion = mozillaVersion;
				browserString = browser + " " + browserVersion;
			}
		}
		else if ( browser=="msie")
		{	browser = "Internet Explorer";
			browserString = browser + " " + browserVersion;
		}
		else 
		{	browserString = browser + " " + browserVersion + mozillaVersion; /* default */
		}

        document.writeln("<p><big>Your web browser seems to be " +
             "<i>" + browserString + "</i>" +
			 " running on <i>" + osString + "</i></big></p>");
        document.writeln("<table border='0'>" +
             "<tr><td bgcolor='" + state + "'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;" +
			 "</td><td>");
        if (msg == "") msg = msgOK;
		document.writeln(msg);
        document.writeln("</td></tr></table>");
      }
    </script>
    
	<p>
	  <b>Details:</b>
	</p>
    <table border="1" cellpadding="5" cellspacing="0">
      <tr>
	<td>Operating System</td>
	<td>
	  <script type="text/javascript">
		document.write(osString);
	  </script>
	</td>
      </tr>
      <tr>
	<td>
	  Web browser
	</td>
	<td>
	  <script type="text/javascript">
	    document.write(_jmol.browser);
	  </script>
	</td>
      </tr>
      <tr>
	<td>
	  Browser version
	</td>
	<td>
	  <script type="text/javascript">
	    document.write(_jmol.browserVersion);
	  </script>
	</td>
      </tr>
      <tr>
	<td>
	  navigator.userAgent
	</td>
	<td>
	  <script type="text/javascript">
	    document.write(navigator.userAgent);
	  </script>
	</td>
      </tr>
      <tr>
	<td>
	  has getElementById()
	</td>
	<td>
	  <script type="text/javascript">
	    document.write(!!document.getElementById);
	  </script>
	</td>
      </tr>
      <tr>
	<td>
	  navigator.javaEnabled()
	</td>
	<td>
	  <script type="text/javascript">
	    document.write(navigator.javaEnabled());
	  </script>
	</td>
      </tr>
    </table>
    <br />
  </body>
</html>
