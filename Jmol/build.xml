<project name="Jmol" default="main" basedir=".">

	<property name="Jmol.home" value="${user.dir}"/>
	<property name="source.dir" value="src"/>
	<property name="classes.dir" value="classes"/>
	<property name="dist.dir" value="dist"/>
	<property name="docs.dir" value="api-docs"/>

	<property name="classpath" value="jars/sax.jar:jars/aelfred.jar:jars/cml.jar:jars/Acme.jar:jars/vecmath1.1-1.12.jar:jars/junit.jar:jars/jas.jar"/>

	<property name="manifest" value="manifest"/>
	
	<property name="build.compiler" value="classic"/>

	<target name="main" depends="jar"/>

	<target name="classes">
		<mkdir dir="${classes.dir}"/>
		<javac srcdir="${source.dir}" destdir="${classes.dir}" classpath="${classpath}"
			debug="off" deprecation="on"
			excludes="**/pending/**,**/jmol/ColorCellEditor.java,**/jmol/FrameHandler.java,**/jmol/MeasurementFactory.java,**/jmol/XYZFile.java"
		/>
		<copy todir="${classes.dir}" >
			<fileset dir="${source.dir}">
				<include name="**/*.jpg" />
				<include name="**/*.gif" />
				<include name="**/*.html" />
				<include name="**/*.dtd" />
				<include name="**/Properties/*" />
				<include name="**/Data/*" />
			</fileset>
		</copy>
	</target>

	<target name="jar" depends="classes">
		<jar jarfile="jars/jmol.jar" >
			<fileset dir="${classes.dir}" >
				<exclude name="**/.*" />
				<exclude name="**/Test*.class" />
				<include name="**/jmol/**" />
			</fileset>
		</jar>
		<jar jarfile="jars/JmolApplet.jar" >
			<fileset dir="${classes.dir}" >
				<exclude name="**/.*" />
				<include name="**/miniJmol/**" />
				<include name="**/jmol/FortranFormat.class" />
				<include name="**/jmol/Matrix3D.class" />
				<include name="**/jmol/DisplaySettings.class" />
				<include name="**/jmol/PhysicalProperty.class" />
			</fileset>
		</jar>
	</target>

	<target name="dist" depends="jar">
		<mkdir dir="${dist.dir}/jmol"/>
		<copy todir="${dist.dir}/jmol/jars" >
			<fileset dir="jars">
				<exclude name="swing.jar" />
				<exclude name="junit.jar" />
			</fileset>
		</copy>
		<copy todir="${dist.dir}/jmol" >
			<fileset dir=".">
				<include name="jmol" />
				<include name="jmol.mac" />
				<include name="jmol.bat" />
				<include name="*.txt" />
			</fileset>
		</copy>
		<copy todir="${dist.dir}/jmol/samples" >
			<fileset dir="samples" />
		</copy>
	</target>

	<target name="dist.zip" depends="dist">
		<zip zipfile="jmol.zip" basedir="${dist.dir}" includes="**" />
	</target>

	<target name="dist.tar.gz" depends="dist">
		<tar tarfile="jmol.tar" basedir="${dist.dir}" includes="**"/>
		<gzip zipfile="jmol.tar.gz" src="jmol.tar"/>
		<delete file="jmol.tar" />
	</target>

	<target name="clean">
		<delete dir="${classes.dir}"/>
	</target>

	<target name="real_clean" depends="clean">
		<delete dir="${docs.dir}"/>
		<delete dir="${dist.dir}"/>
	</target>

	<target name="run" depends="classes">
		<java fork="true" classpath="${classpath}:classes" classname="org.openscience.jmol.Jmol" />
	</target>

	<target name="run_tests" depends="classes">
		<java fork="true" classpath="${classpath}:classes" classname="org.openscience.jmol.TestAll" />
	</target>

	<target name="docs">
		<mkdir dir="${docs.dir}"/>
		<javadoc destdir="${docs.dir}" classpath="${classpath}" sourcepath="src"
			private="true" packagenames="org.openscience.jmol,org.openscience.miniJmol"
		/>
	</target>

</project>

