<?xml version="1.0"?>
<!DOCTYPE book PUBLIC "-//OASIS//DTD DocBook XML V4.2//EN"
  "../xml-dtd-4.2/docbookx.dtd"
>
<book id="jmol-devel-guide">
  <bookinfo>
    <title>Jmol Developer's Guide</title>
  </bookinfo>

  <chapter id="BuildingJmol">
    <title>Building Jmol</title>
    <para>Prerequisites:
      <itemizedlist>
        <listitem>
          <para>Java 2 JDK 1.4
	  (<ulink url="http://java.sun.com/">http://java.sun.com/</ulink>)
	  
          </para>
        </listitem>
        <listitem>
          <para>Apache Ant
	  (<ulink url="http://jakarta.apache.org/ant">http://jakarta.apache.org/ant</ulink>)
          </para>
        </listitem>
        <listitem>
          <para>Jmol source code </para>
        </listitem>
      </itemizedlist>
      The Jmol source code can be either downloaded
      (see <ulink url="http://sourceforge.net/project/showfiles.php?group_id=23629">
      SourceForge project files</ulink>)
      or checked out from the CVS repository
      (see <ulink url="http://sourceforge.net/cvs/?group_id=23629">SourceForge CVS access</ulink>).
    </para>

    <para>Once you have all the prerequisites, Jmol can be built from the top
      source directory with the following command:
    </para>

    <para>On Unix,
      <programlisting>
        <prompt>/home/user/programming/Jmol&gt;</prompt>
	<command>ant -Ddocbook.dir=/home/user/programming/docbook-xsl</command>
      </programlisting>
    </para>

    <para>On Windows,
      <programlisting>
        <prompt>h:\programming\Jmol&gt;</prompt>
	<command>ant -Ddocbook.dir=h:\programming\docbook-xsl</command>
      </programlisting>
    </para>

    <para>
      where <parameter class="command">docbook.dir</parameter> is set equal to the absolute path of
      the DocBook XSL.
    </para>

    <section>
      <title>Compiling with different JVM's</title>
      <section>
        <title>Compiling with Java 1.2</title>
        <para>
          The applet needs to be compiled with javac 1.2, to be compatible with many older browsers.
          This can be done by doing:
          <programlisting>
            <prompt>h:\programming\Jmol&gt;</prompt>
	    <command>setenv JAVA_HOME /path/to/java1.2</command>
            <prompt>h:\programming\Jmol&gt;</prompt>
	    <command>ant -Dbuild.compiler=classic</command>
          </programlisting>
        </para>
      </section>
      <section>
        <title>Compiling with Java 1.4</title>
        <para>
          The application requires to be compiled with javac from J2SDK 1.4 or higher. 
          This can be done by doing:
          <programlisting>
            <prompt>h:\programming\Jmol&gt;</prompt>
	    <command>setenv JAVA_HOME /path/to/java1.4</command>
            <prompt>h:\programming\Jmol&gt;</prompt>
	    <command>ant -Dbuild.compiler=javac1.4</command>
          </programlisting>
        </para>
      </section>
    </section>
  </chapter>

  <chapter id="RunningJmol">
    <title>Running Jmol</title>
    <para>
      On Unix, the development version of Jmol is run by simply executing
      the jmol script in the Jmol development directory.
    </para>

    <para>
      On Windows, the environment variable JMOL_HOME must be set to the development
      directory, and then the jmol.bat script can be executed. For example:
      <programlisting>
        <prompt>H:\programming\Jmol&gt;</prompt>
	<command>set JMOL_HOME=h:\programming\Jmol</command>
        <prompt>H:\programming\Jmol&gt;</prompt>
	<command>jmol.bat</command>
      </programlisting>
    </para>
  </chapter>

  <chapter id="CodingStandard">
    <title>Coding Standard</title>
    <para>
      Jmol source code should be written in a style which adheres to
      <ulink url="http://www.amazon.com/exec/obidos/ASIN/0521777682">"The 
      Elements of Java Style" by Vermeulen, et al</ulink>.
    </para>
  </chapter>

  <chapter id="Releasing">
    <title>Making a release</title>
    <para>
      Making releases is currently one of the core responsibilities of
      the project leader. A release primarily consists of the .zip and
      .tar.gz distributions. Binary packages are not part of the Jmol
      release, but the release manager will inform the packagers in time
      to make binary packages.
    </para>
    <para>
      A Jmol release consists of both the application
      <emphasis>and</emphasis> the applet. Both must work as expected.
    </para>
    <section id="testing">
      <title>Testing before release</title>
      <para>
        In the <filename class="directory">samples/</filename>
        directory a number of test files are located for the input
        filters. All files in that directory must be checked to be
        readable before every release.
      </para>
      <para>
        The following table names all files, the reader classes which
        should read it, and the <emphasis>Extra</emphasis>
        windows that should be available.
        <informaltable>
          <tgroup cols="3">
            <thead>
              <row>
                <entry><para>filename</para></entry>
                <entry><para>reader</para></entry>
                <entry><para>extra</para></entry>
              </row>
            </thead>
            <tbody>
            <row>
              <entry><para>1crn.pdb</para></entry>
              <entry><para>PDBReader</para></entry>
              <entry><para></para></entry>
            </row>
            <row>
              <entry><para>4-cyanopheylnitrene-Benzazirine-TS.g94.out</para></entry>
              <entry><para>Gaussian94Reader</para></entry>
              <entry><para>Vibrate</para></entry>
            </row>
            <row>
              <entry><para>ammonia.adf.out</para></entry>
              <entry><para>ADFReader</para></entry>
              <entry><para>Animate, Vibrate</para></entry>
            </row>
            <row>
              <entry><para>azt.xyz</para></entry>
              <entry><para>XYZReader</para></entry>
              <entry><para></para></entry>
            </row>
            <row>
              <entry><para>bulk_Si.in</para></entry>
              <entry><para>ABINITReader</para></entry>
              <entry><para>Crystal</para></entry>
            </row>
            <row>
              <entry><para>caffeine.xyz</para></entry>
              <entry><para>XYZReader</para></entry>
              <entry><para></para></entry>
            </row>
            <row>
              <entry><para>CdSe_nanocrystal.xyz</para></entry>
              <entry><para>XYZReader</para></entry>
              <entry><para></para></entry>
            </row>
            <row>
              <entry><para>ch3oh_ace.out</para></entry>
              <entry><para>Aces2Reader</para></entry>
              <entry><para>Vibrate</para></entry>
            </row>
            <row>
              <entry><para>ch3oh_g94.out</para></entry>
              <entry><para>Gaussian94Reader</para></entry>
              <entry><para>Animate, Vibrate</para></entry>
            </row>
            <row>
              <entry><para>ch3oh_gam.out</para></entry>
              <entry><para>GamessReader</para></entry>
              <entry><para>Vibrate</para></entry>
            </row>
            <row>
              <entry><para>ch4-opt.out</para></entry>
              <entry><para>JaguarReader</para></entry>
              <entry><para>Animate</para></entry>
            </row>
            <row>
              <entry><para>cholesterol.xyz</para></entry>
              <entry><para>XYZReader</para></entry>
              <entry><para></para></entry>
            </row>
            <row>
              <entry><para>Cl2O.log</para></entry>
              <entry><para>GamessReader</para></entry>
              <entry><para>Animate</para></entry>
            </row>
            <row>
              <entry><para>conformeren.cml</para></entry>
              <entry><para>CMLReader</para></entry>
              <entry><para>Animate, Graph</para></entry>
              </row>
              <row>
              <entry><para>cs2.xyz</para></entry>
              <entry><para>XYZReader</para></entry>
              <entry><para></para></entry>
              </row>
              <row>
              <entry><para>cyclohexane_chair.xyz</para></entry>
              <entry><para>XYZReader</para></entry>
              <entry><para></para></entry>
              </row>
              <row>
              <entry><para>cyclohexane_movie.xyz</para></entry>
              <entry><para>XYZReader</para></entry>
              <entry><para>Animate</para></entry>
              </row>
              <row>
              <entry><para>ddt.xyz</para></entry>
              <entry><para>XYZReader</para></entry>
              <entry><para></para></entry>
              </row>
              <row>
              <entry><para>diels-alder_movie.xyz</para></entry>
              <entry><para>XYZReader</para></entry>
              <entry><para>Animate</para></entry>
              </row>
              <row>
              <entry><para>dna.xyz</para></entry>
              <entry><para>XYZReader</para></entry>
              <entry><para></para></entry>
              </row>
              <row>
              <entry><para>estron.cml</para></entry>
              <entry><para>CMLReader</para></entry>
              <entry><para>Crystal</para></entry>
              </row>
              <row>
              <entry><para>ethanol.xyz</para></entry>
              <entry><para>XYZReader</para></entry>
              <entry><para></para></entry>
              </row>
              <row>
              <entry><para>ethene.mm1gp</para></entry>
              <entry><para>ChemicalMMReader</para></entry>
              <entry><para></para></entry>
              </row>
              <row>
              <entry><para>frame_1.res</para></entry>
              <entry><para>ShelXReader</para></entry>
              <entry><para>Crystal</para></entry>
              </row>
              <row>
              <entry><para>g98.out</para></entry>
              <entry><para>Gaussian98Reader</para></entry>
              <entry><para>Animate, Vibrate</para></entry>
              </row>
              <row>
              <entry><para>glycine-crystal.cml</para></entry>
              <entry><para>CMLReader</para></entry>
              <entry><para></para></entry>
              </row>
              <row>
              <entry><para>HfO2_mol_opt.in</para></entry>
              <entry><para>ABINITReader</para></entry>
              <entry><para>Crystal</para></entry>
              </row>
              <row>
              <entry><para>HfO2_on_Si_relax.in</para></entry>
              <entry><para>ABINITReader</para></entry>
              <entry><para>Crystal</para></entry>
              </row>
              <row>
              <entry><para>met-enkaphalin_movie.xyz</para></entry>
              <entry><para>XYZReader</para></entry>
              <entry><para>Animate</para></entry>
              </row>
              <row>
              <entry><para>methanol1.cml</para></entry>
              <entry><para>CMLReader</para></entry>
              <entry><para></para></entry>
              </row>
              <row>
              <entry><para>methanol2.cml</para></entry>
              <entry><para>CMLReader</para></entry>
              <entry><para></para></entry>
              </row>
              <row>
              <entry><para>pdhch3.in</para></entry>
              <entry><para>Jaguar Input is not yet supported</para></entry>
              <entry><para></para></entry>
              </row>
              <row>
              <entry><para>phenol-without-para-G.g98.out</para></entry>
              <entry><para>Gaussian98Reader</para></entry>
              <entry><para>Animate, Vibrate</para></entry>
              </row>
              <row>
              <entry><para>phenylnitrene.g92.out</para></entry>
              <entry><para>Gaussian92Reader</para></entry>
              <entry><para>Vibrate</para></entry>
              </row>
              <row>
              <entry><para>phenylnitrene.g94.out</para></entry>
              <entry><para>Gaussian94Reader</para></entry>
              <entry><para></para></entry>
              </row>
              <row>
              <entry><para>slab_7Si_3Vac_2x.in</para></entry>
              <entry><para>ABINITReader</para></entry>
              <entry><para>Crystal</para></entry>
              </row>
              <row>
              <entry><para>slab_7Si_3Vac_2x_relax_2x1.out</para></entry>
              <entry><para>ABINITReader</para></entry>
              <entry><para>Crystal, Animate, Graph</para></entry>
              </row>
              <row>
              <entry><para>SN1_reaction.cml</para></entry>
              <entry><para>CMLReader</para></entry>
              <entry><para>Animate</para></entry>
              </row>
              <row>
              <entry><para>SN1_reaction.xyz</para></entry>
              <entry><para>XYZReader</para></entry>
              <entry><para>Animate</para></entry>
              </row>
              <row>
              <entry><para>SN2_reaction.xyz</para></entry>
              <entry><para>XYZReader</para></entry>
              <entry><para>Animate</para></entry>
              </row>
              <row>
              <entry><para>t54.in</para></entry>
              <entry><para>ABINITReader</para></entry>
              <entry><para>Crystal</para></entry>
              </row>
              <row>
              <entry><para>taxol.xyz</para></entry>
              <entry><para>XYZReader</para></entry>
              <entry><para></para></entry>
              </row>
              <row>
              <entry><para>test.mol</para></entry>
              <entry><para>MdlReader</para></entry>
              <entry><para></para></entry>
              </row>
              <row>
              <entry><para>tms.log</para></entry>
              <entry><para>Gaussian94Reader</para></entry>
              <entry><para>Animate, Chemical Shift</para></entry>
              </row>
              <row>
              <entry><para>toluene.pdb</para></entry>
              <entry><para>PDBReader</para></entry>
              <entry><para></para></entry>
              </row>
              <row>
              <entry><para>viagra.xyz</para></entry>
              <entry><para>XYZReader</para></entry>
              <entry><para></para></entry>
              </row>
              <row>
              <entry><para>zeolite_AFl.out</para></entry>
              <entry><para>ABINITReader</para></entry>
              <entry><para>Crystal, Graph, Animate</para></entry>
              </row>
              <row>
              <entry><para>zoloft.xyz</para></entry>
              <entry><para>XYZReader</para></entry>
              <entry><para></para></entry>
              </row>
            </tbody>
          </tgroup>
        </informaltable>
      </para>
    </section>
  </chapter>

  <chapter id="Packaging">
    <title>Packaging</title>
    <para>
      Distribution packages will be made for any platform for which a
      developer promises to provide support. File used to create packages
      should be commited to CVS under the Jmol/packaging
      directory. Currently the following packages are available:
      <itemizedlist>
        <listitem><para>Debian (by Egon Willighagen) </para></listitem>
        <listitem><para>RPM (by Miguel Howard) </para></listitem>
      </itemizedlist>
    </para>
  </chapter>

  <chapter id="CVS">
    <title>Working with Jmol's CVS</title>
    <para>
      This section gives information on how to work with Jmol's CVS
      at SourceForge.
    </para>
    <section id="tagging">
      <title>Tagging CVS</title>
      <para>
        It is important to tag CVS when a distribution was made. This makes it
        possible to later retrieve the exact source code from CVS in that release.
        This can be done with
        <command>cvs tag <parameter>tag-name</parameter></command>
        in the directory where the CVS files are stored.
      </para>
    </section>
    <section id="branching">
      <title>CVS Branches</title>
      <para>
        Sometimes it is convenient to have separate branches to work on.
        One for an uncoming release, and one branch for the unstable version.
        Minor bug fixes can then go into the stable branch, while major
        changes can go into the unstable branch. This section explains how
        to access, use, and create branches.
      </para>
      <section id="branch_access">
        <title>Accessing a branch</title>
        <para>
          The command <command>cvs checkout <parameter>module</parameter></command>
          by default gets the source code from the HEAD branch, which is
          the unstable branch of Jmol.
        </para>
        <para>
          Accessing a specific branch can be done with, e.g. the b6 branch:
          <programlisting>
cvs checkout -r b6 -d Jmol-6 Jmol
          </programlisting>
          This will check out a copy of the Jmol module from the b6 branch into
          a directory called <filename class="directory">Jmol-6</filename>.
        </para>
        <para>
          To determine to which branch a specific locally stored file belongs,
          you can do <command>cvs status <parameter>file</parameter></command>.
        </para>
      </section>
      <section id="branch_creating">
        <title>Creating a branch</title>
        <para>
          A branch of HEAD can be created with the <command>cvs rtag -b -r 
          HEAD <parameter>branch-name</parameter> 
          <parameter>module</parameter></command> command.
        </para>
      </section>
      <section id="branch_merging">
        <title>Merging branches</title>
        <para>
          Bug fixes which have been commited to a branch can be merged to the HEAD
          branch. To do this, check out (or update) a HEAD branch, and type in that
          directory <command>cvs update -j <parameter>branch-to-merge</parameter></command>.
          After this the branch from which the changes were merged with HEAD should
          be tagged, to make it possible to merge later changes with HEAD too.
          For example, a session might look like:
          <programlisting>
> cd ~/data/SF/Jmol/Jmol-HEAD
> cvs update -j b6
> cd ~/data/SF/Jmol/Jmol-6
> cvs tag b6-merged-20030725
          </programlisting>
          Changes made after this merger to branch b6, can then be merged with HEAD with:
          <programlisting>
> cd ~/data/SF/Jmol/Jmol-HEAD
> cvs update -j b6-merged-20030725 -j b6
> cd ~/data/SF/Jmol/Jmol-6
> cvs tag b6-merged-20031011
          </programlisting>
        </para>
      </section>
    </section>
  </chapter>
</book>


