<project default="deploy" basedir=".">

  <!--
    To use this script, the scp task must be available.
    The scp task requires the jsch jar in the class path.
  -->
  
  <property name="from.dir" value="build/html" />

  <!-- Copying files to website -->
  <target name="deploy" >
  	
    <!-- Ask user for confirmation -->
    <input
      message="Do you really want to copy files to the website (y/n) ?"
      validargs="y,n"
      addproperty="do.scp"
    />
    <condition property="do.abort">
      <equals arg1="n" arg2="${do.scp}"/>
    </condition>
    <fail if="do.abort">Build aborted by user.</fail>
    
    <!-- Ask user for username and password -->
    <input
      message="Please enter username:"
      addproperty="ssh.user"
    />
    <input
      message="Please enter password:"
      addproperty="ssh.password"
    />
    
    <!-- Do the copy using scp -->
    <echo message="Copying all files to Jmol website"/>
    <copy file="cache.properties" tofile="cache_tmp.properties" overwrite="true"/>
    <scp
      todir="${ssh.user}:${ssh.password}@shell.sourceforge.net:/home/groups/j/jm/jmol/htdocs"
      trust="yes" failonerror="true">
      <fileset dir="${from.dir}">
        <modified>
          <param name="cache.cachefile" value="cache_tmp.properties"/>
        </modified>
      </fileset>
    </scp>
    <copy file="cache_tmp.properties" tofile="cache.properties"/>
    <delete file="cache_tmp.properties"/>
    <sshexec
      host="shell.sourceforge.net" username="${ssh.user}" password="${ssh.password}"
      trust="yes" failonerror="false"
      command="chmod -R -f ug+rw,o+r /home/groups/j/jm/jmol/htdocs/">
    </sshexec>
    
  </target>
  
</project>
